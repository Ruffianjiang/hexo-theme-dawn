<% if (theme.github.username && theme.github.popular_repos.length) { %>
<script type="text/javascript">
var popular_repos = function() {

  var baiduTpl = new Object();

  var handleTpl = function() {
    baiduTpl.popular_list = baidu.template("popular-list-template");
  };

  var handleGithub = function() {
    var popularContainer = $(".popular-container");

    var repos = "<%=theme.github.popular_repos%>".split(",");
    for (var i in repos) {
      var name = repos[i];
      $.get("https://api.github.com/repos/<%=theme.github.username%>/" + name, handle);
    }

    function handle(result) {
      result.updated_at = result.updated_at.split("T")[0];
      if (result) {
        var html = baiduTpl.popular_list(result);
        popularContainer.append(html);
        $(".geopattern").each(function() {
          $(this).geopattern($(this).data('pattern-id'));
        });
      }
    }
  };

  return {
    init: function() {
      handleTpl();
      handleGithub();
    }
  }
};
$(popular_repos().init);
</script>
<%}%>